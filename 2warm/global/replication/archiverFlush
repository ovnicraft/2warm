-- archiverFlush
-- Copyright (c) 2ndQuadrant, 2009

--
-- Issue checkpoints in order to force archive segments to close.
-- Designed to be called in parallel with a script that will stop
-- the database server from accepting connections once this one has
-- connected.
--

-- Sleep to give our parent script time to block new connections
SELECT pg_sleep(10);

-- Initial flush
checkpoint;

--There shouldn't be any backups going on; cancel just to be safe
select pg_stop_backup();

-- Checkpoint again
checkpoint;

-- Give archiver time to finish processing
SELECT pg_sleep(20);
